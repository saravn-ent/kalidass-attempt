---
import Layout from '../../layouts/Layout.astro';
import serviceDetails from '../../data/serviceDetails.json';

export async function getStaticPaths() {
  return serviceDetails.map((service) => ({
    params: { slug: service.slug },
    props: { service },
  }));
}

const { service } = Astro.props;
const whatsappLink = `https://wa.me/919092303060?text=${encodeURIComponent(service.whatsappMsg)}`;

// Dynamic Labels for Travel Guide / Service Info Section
const isTour = ['Temple Tours', 'Popular Destinations'].includes(service.category);

const guideLabels = isTour ? {
  sectionTitle: "Travel Guide & Tips",
  sectionIcon: "fa-book-open",
  col1Title: "History & Significance",
  col1Icon: "fa-landmark",
  col2Title: "Darshan Timings",
  col2Icon: "fa-clock",
  tipsTitle: "Pro Tips for First-Timers"
} : {
  sectionTitle: "Service Details & Information",
  sectionIcon: "fa-circle-info",
  col1Title: "Service Overview",
  col1Icon: "fa-briefcase",
  col2Title: "Availability & Coverage",
  col2Icon: "fa-calendar-check",
  tipsTitle: "Important Information"
};

// Image Mapping (Same as Tours.astro)
const tourImages: Record<string, string> = {
  "tirupati-package": "/images/temple/Tirupati-Balaji.jpg",
  "thiruvannamalai-girivalam-trip": "/images/temple/Thiruvannamalai-Girivalam.jpg",
  "rameswaram-2-days": "/images/temple/Rameswaram.avif",
  "navagraha-tour": "/images/temple/Navagraha.jpg",
  "kanchipuram-temple-trip": "/images/temple/Kanchipuram-Temple.jpg",
  "chidambaram-temple-trip": "/images/temple/Chidambaram-Natarajar-Temple.jpg",
  "sabarimala-trip": "/images/temple/Sabarimala-Temple.jpg",
  "pondicherry-one-day-trip": "https://images.pexels.com/photos/32009229/pexels-photo-32009229.jpeg?auto=compress&cs=tinysrgb&w=800",
  "vellore-golden-temple": "/images/temple/Vellore-Golden.jpg",
  "mahabalipuram-ecr-temple-route": "/images/temple/Mahabalipuram-ECR-Temples.jpg",
  "one-day-chennai-city-tour": "/images/temple/chennai-city.jpg" 
};

const categoryImages: Record<string, string> = {
  "Acting Driver Services": "/images/services/acting-drivers.jpg",
  "Corporate Travel": "/images/services/corporate.jpg",
  "Airport Transfers": "/images/services/airport-transfer.jpg",
  "Temple Tours": "/images/services/temple-tours.jpg",
  "Premium Fleet Rental": "/images/services/corporate.jpg"
};

const heroImage = tourImages[service.slug] || categoryImages[service.category] || '/images/logo.png';

const schema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": service.title,
  "description": service.overview,
  "provider": {
    "@type": "LocalBusiness",
    "name": "Kalidass Travels",
    "image": "https://kalidasstravels.in/images/logo.png",
    "telephone": "+919092303060",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Chennai",
      "addressRegion": "Tamil Nadu",
      "addressCountry": "IN"
    }
  },
  "areaServed": {
    "@type": "City",
    "name": "Chennai"
  },
  "url": Astro.url.href
};
---

<Layout 
  title={`${service.title} - Kalidass Travels`}
  description={service.overview}
  image={heroImage}
  type="article"
  schema={schema}
>
  <main class="bg-gray-50 min-h-screen pb-20">
    <!-- Hero Header -->
    <div class="bg-black text-white pt-32 pb-16 px-6 relative overflow-hidden">
      
      {/* Background Image Layer */}
      {heroImage && (
        <div class="absolute inset-0 z-0">
          <img 
            src={heroImage} 
            alt={service.title} 
            class="w-full h-full object-cover opacity-60"
          />
        </div>
      )}

      {/* Gradient Overlay (Darker if image exists to ensure readability) */}
      <div class={`absolute inset-0 z-0 ${heroImage ? 'bg-gradient-to-t from-black via-black/80 to-transparent' : 'bg-gradient-to-br from-red-900/40 to-black'}`}></div>

      <div class="max-w-4xl mx-auto relative z-10">
        <div class="flex flex-wrap gap-3 mb-4">
          <span class="inline-block py-1 px-3 rounded-full bg-red-600/20 border border-red-500/30 text-red-400 text-xs font-semibold tracking-wider uppercase">
            {service.category}
          </span>
        </div>
        <h1 class="text-3xl md:text-5xl font-bold mb-4 leading-tight">{service.title}</h1>
        {service.overview && <p class="text-gray-300 text-lg max-w-2xl whitespace-pre-line">{service.overview}</p>}
      </div>
    </div>

    <div class="max-w-4xl mx-auto px-6 -mt-8 relative z-20">
      <div class="bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden">
        
        <!-- Route Plan Section (Creative Card Style) -->
        {service.routePlan && (
          <div class="p-6 md:p-8 border-b border-gray-100 bg-gray-50/50">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
                <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                  <i class="fa-solid fa-map-location-dot text-red-600"></i> Route Plan
                </h2>
                {service.duration && (
                    <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white border border-gray-200 shadow-sm text-sm font-bold text-gray-700">
                        <i class="fa-regular fa-clock text-red-600"></i> {service.duration}
                    </span>
                )}
            </div>

            <div class="relative">
              <!-- Connecting Line (Desktop) -->
              <div class="absolute top-4 left-0 w-full h-1 bg-gray-200 hidden md:block"></div>
              
              <!-- Horizontal Scroll Container -->
              <div class="flex overflow-x-auto pb-4 gap-4 md:gap-0 md:justify-between snap-x scrollbar-hide">
                {service.routePlan.map((stop, index) => (
                  <div class="flex flex-col items-center text-center gap-3 min-w-[140px] md:min-w-0 flex-1 snap-center relative z-10">
                    <div class="w-9 h-9 rounded-full bg-white border-4 border-red-500 flex items-center justify-center shadow-sm shrink-0">
                      <span class="text-xs font-bold text-gray-700">{index + 1}</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg shadow-sm border border-gray-100 w-full">
                      <h4 class="font-bold text-gray-900 text-sm">{stop.stop}</h4>
                      <p class="text-xs text-gray-500 leading-tight">{stop.desc}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        <!-- Tariff Section -->
        {service.tariff && (
          <div class="p-6 md:p-8 border-b border-gray-100">
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
              <i class="fa-solid fa-tag text-red-600"></i> Tariff & Pricing
            </h2>
            
            {/* Smart Tariff Display */}
            {service.tariff.headers.length > 3 && service.tariff.headers[service.tariff.headers.length - 1].toLowerCase().includes('total') ? (
              <div class="space-y-4">
                {service.tariff.rows.map((row, rowIndex) => (
                  <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-center mb-2">
                      <h3 class="font-bold text-gray-900 text-lg">{row[0]}</h3>
                      <span class="text-xl font-bold text-green-700">{row[row.length - 1]}</span>
                    </div>
                    
                    <details class="group">
                      <summary class="text-sm text-red-600 font-medium cursor-pointer hover:text-red-700 flex items-center gap-1 select-none">
                        <span>View Breakdown</span>
                        <i class="fa-solid fa-chevron-down text-xs transition-transform group-open:rotate-180"></i>
                      </summary>
                      <div class="mt-3 pt-3 border-t border-gray-100 bg-gray-50 rounded p-3">
                        <p class="text-xs text-gray-500 mb-2 uppercase tracking-wider font-semibold">Fare Components</p>
                        {service.tariff.headers.slice(1, -1).map((header, index) => (
                          <div class="flex justify-between items-center mb-2 last:mb-0">
                            <div class="flex items-center gap-2">
                              <span class="w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[10px] text-gray-500">
                                <i class="fa-solid fa-plus"></i>
                              </span>
                              <span class="text-sm text-gray-600">{header}</span>
                            </div>
                            <span class="font-medium text-gray-900 text-sm">{row[index + 1]}</span>
                          </div>
                        ))}
                        <div class="mt-3 pt-2 border-t border-gray-200 border-dashed flex justify-between items-center">
                           <div class="flex items-center gap-2">
                              <span class="w-5 h-5 rounded-full bg-green-100 flex items-center justify-center text-[10px] text-green-600">
                                <i class="fa-solid fa-equals"></i>
                              </span>
                              <span class="text-sm font-bold text-gray-800">Est. Total</span>
                           </div>
                           <span class="font-bold text-green-700 text-base">{row[row.length - 1]}</span>
                        </div>
                      </div>
                    </details>
                  </div>
                ))}
              </div>
            ) : (
              <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                  <thead>
                    <tr class="bg-gray-50 border-b border-gray-200">
                      {service.tariff.headers.map((header) => (
                        <th class="py-3 px-4 text-sm font-semibold text-gray-700 uppercase tracking-wider">{header}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-100">
                    {service.tariff.rows.map((row) => (
                      <tr class="hover:bg-gray-50 transition-colors">
                        {row.map((cell, index) => (
                          <td class={`py-3 px-4 text-gray-800 font-medium ${index === row.length - 1 ? 'font-bold text-green-700' : ''}`}>
                            {cell}
                          </td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}

            {service.tariff.note && (
              <p class="mt-4 text-sm text-gray-500 italic bg-yellow-50 p-3 rounded border border-yellow-100">
                <i class="fa-solid fa-circle-info mr-2 text-yellow-600"></i> {service.tariff.note}
              </p>
            )}
          </div>
        )}

        <!-- Details Grid -->
        <div class="grid md:grid-cols-2 gap-0 divide-y md:divide-y-0 md:divide-x divide-gray-100">
          
          <!-- Includes -->
          {service.includes && (
            <div class="p-6 md:p-8">
              <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-check-circle text-green-600"></i> What's Included
              </h3>
              <ul class="space-y-3">
                {service.includes.map((item) => (
                  <li class="flex items-start gap-3 text-gray-600 text-sm">
                    <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-green-500 shrink-0"></span>
                    {item}
                  </li>
                ))}
              </ul>
            </div>
          )}

          <!-- Excludes -->
          {service.excludes && (
            <div class="p-6 md:p-8 bg-gray-50/50">
              <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-times-circle text-red-500"></i> Not Included
              </h3>
              <ul class="space-y-3">
                {service.excludes.map((item) => (
                  <li class="flex items-start gap-3 text-gray-500 text-sm">
                    <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-red-300 shrink-0"></span>
                    {item}
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>

        <!-- Travel Guide / Service Info Section -->
        {service.travelGuide && (
          <div class={`p-6 md:p-8 border-t border-gray-100 ${isTour ? 'bg-orange-50/30' : 'bg-blue-50/30'}`}>
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
              <i class={`fa-solid ${guideLabels.sectionIcon} ${isTour ? 'text-orange-600' : 'text-blue-600'}`}></i> {guideLabels.sectionTitle}
            </h2>
            
            <div class="grid md:grid-cols-2 gap-8">
              {/* History / Overview */}
              {service.travelGuide.history && (
                <div>
                  <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                    <i class={`fa-solid ${guideLabels.col1Icon} ${isTour ? 'text-orange-500' : 'text-blue-500'}`}></i> {guideLabels.col1Title}
                  </h3>
                  <p class="text-gray-600 text-sm leading-relaxed whitespace-pre-line">
                    {service.travelGuide.history}
                  </p>
                </div>
              )}

              {/* Timings / Availability */}
              <div class="space-y-6">
                {service.travelGuide.timings && (
                  <div>
                    <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                      <i class={`fa-solid ${guideLabels.col2Icon} ${isTour ? 'text-orange-500' : 'text-blue-500'}`}></i> {guideLabels.col2Title}
                    </h3>
                    <p class="text-gray-600 text-sm whitespace-pre-line">
                      {service.travelGuide.timings}
                    </p>
                  </div>
                )}
                
                {service.travelGuide.dressCode && (
                  <div>
                    <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                      <i class="fa-solid fa-user-tie text-orange-500"></i> Dress Code
                    </h3>
                    <p class="text-gray-600 text-sm">
                      {service.travelGuide.dressCode}
                    </p>
                  </div>
                )}
              </div>
            </div>

            {/* Pro Tips / Important Info */}
            {service.travelGuide.tips && (
              <div class={`mt-8 bg-white rounded-lg p-5 border shadow-sm ${isTour ? 'border-orange-100' : 'border-blue-100'}`}>
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <i class={`fa-solid fa-lightbulb ${isTour ? 'text-yellow-500' : 'text-blue-500'}`}></i> {guideLabels.tipsTitle}
                </h3>
                <ul class="grid md:grid-cols-2 gap-3">
                  {service.travelGuide.tips.map((tip) => (
                    <li class="flex items-start gap-2 text-sm text-gray-600">
                      <i class={`fa-solid fa-check mt-1 ${isTour ? 'text-green-500' : 'text-blue-500'}`}></i>
                      <span>{tip}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        )}


        <!-- FAQ Section -->
        {service.faq && (
          <div class="p-6 md:p-8 border-t border-gray-100">
            <h3 class="text-lg font-bold text-gray-900 mb-6">Frequently Asked Questions</h3>
            <div class="grid gap-4">
              {service.faq.map((item) => (
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                  <p class="font-semibold text-gray-900 text-sm mb-2 flex items-start gap-2">
                    <span class="text-red-600">Q:</span> {item.q}
                  </p>
                  <p class="text-gray-600 text-sm pl-6 border-l-2 border-gray-200">
                    {item.a}
                  </p>
                </div>
              ))}
            </div>
          </div>
        )}

        <!-- Notes -->
        {service.notes && (
          <div class="p-6 md:p-8 bg-blue-50 border-t border-blue-100">
            <h4 class="text-sm font-bold text-blue-900 uppercase tracking-wide mb-3">Important Notes</h4>
            <ul class="space-y-2">
              {service.notes.map((note) => (
                <li class="text-blue-800 text-sm flex items-start gap-2">
                  <i class="fa-solid fa-info-circle mt-1 opacity-70"></i> {note}
                </li>
              ))}
            </ul>
          </div>
        )}

        <!-- Sticky Mobile CTA / Desktop Footer CTA -->
        <div class="p-6 bg-gray-900 text-white flex flex-col md:flex-row items-center justify-between gap-4 sticky bottom-0 md:relative z-30">
          <div>
            <p class="text-gray-400 text-xs uppercase tracking-wider mb-1">Ready to book?</p>
            <p class="font-bold text-lg">Instant Confirmation via WhatsApp</p>
          </div>
          <a 
            href={whatsappLink}
            target="_blank"
            class="w-full md:w-auto bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-green-900/20"
          >
            <i class="fa-brands fa-whatsapp text-xl"></i>
            Book Now
          </a>
        </div>

      </div>
    </div>
  </main>
</Layout>
