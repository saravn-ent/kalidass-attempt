---
import Layout from '../../../layouts/Layout.astro';
import serviceDetails from '../../../data/serviceDetails.json';

export async function getStaticPaths() {
  return [
    { params: { category: 'acting-drivers' }, props: { title: 'Acting Drivers', description: 'Professional drivers for your personal vehicle' } },
    { params: { category: 'corporate' }, props: { title: 'Corporate Travel', description: 'Reliable transport solutions for businesses' } },
    { params: { category: 'airport-transfer' }, props: { title: 'Airport Transfer', description: 'Seamless airport pickups and drops' } },
    { params: { category: 'temple-tours' }, props: { title: 'Temple Tours', description: 'Spiritual journeys across Tamil Nadu' } },
    { params: { category: 'popular-destinations' }, props: { title: 'Popular Destinations', description: 'Explore heritage sites, beaches, and city tours' } },
  ];
}

const { category } = Astro.params;
const { title, description } = Astro.props;

// Logic to map the 36 services to the 4 main categories
const getServicesForCategory = (catSlug: string) => {
  return serviceDetails.filter(service => {
    const cat = service.category;
    const slug = service.slug;

    if (catSlug === 'acting-drivers') {
      return cat === 'Acting Driver Services' || slug === 'driver-car-for-weddings';
    }
    if (catSlug === 'corporate') {
      return cat === 'Corporate Travel' || cat === 'Premium Fleet Rental' || slug === 'outstation-car-rental-per-km';
    }
    if (catSlug === 'airport-transfer') {
      return cat === 'Airport Transfers' || slug === 'luggage-parcel-delivery-chennai';
    }
    if (catSlug === 'temple-tours') {
      return cat === 'Temple Tours';
    }
    if (catSlug === 'popular-destinations') {
      const destinations = [
        "pondicherry-one-day-trip",
        "mahabalipuram-ecr-temple-route",
        "one-day-chennai-city-tour",
        "kanchipuram-temple-trip",
        "vellore-golden-temple"
      ];
      return destinations.includes(slug);
    }
    return false;
  });
};

const categoryServices = getServicesForCategory(category);

const categoryImages: Record<string, string> = {
  'acting-drivers': '/images/services/acting-drivers.jpg',
  'corporate': '/images/services/corporate.jpg',
  'airport-transfer': '/images/services/airport-transfer.jpg',
  'temple-tours': '/images/services/temple-tours.jpg',
  'popular-destinations': '/images/temple/Mahabalipuram-ECR-Temples.jpg'
};

const serviceImages: Record<string, string> = {
  "tirupati-package": "/images/temple/Tirupati-Balaji.jpg",
  "thiruvannamalai-girivalam-trip": "/images/temple/Thiruvannamalai-Girivalam.jpg",
  "rameswaram-2-days": "/images/temple/Rameswaram.avif",
  "navagraha-tour": "/images/temple/Navagraha.jpg",
  "kanchipuram-temple-trip": "/images/temple/Kanchipuram-Temple.jpg",
  "chidambaram-temple-trip": "/images/temple/Chidambaram-Natarajar-Temple.jpg",
  "sabarimala-trip": "/images/temple/Sabarimala-Temple.jpg",
  "pondicherry-one-day-trip": "https://images.pexels.com/photos/32009229/pexels-photo-32009229.jpeg?auto=compress&cs=tinysrgb&w=800",
  "vellore-golden-temple": "/images/temple/Vellore-Golden.jpg",
  "mahabalipuram-ecr-temple-route": "/images/temple/Mahabalipuram-ECR-Temples.jpg",
  "one-day-chennai-city-tour": "/images/temple/chennai-city.jpg" 
};

const serviceCategoryImages: Record<string, string> = {
  "Acting Driver Services": "/images/services/acting-drivers.jpg",
  "Corporate Travel": "/images/services/corporate.jpg",
  "Airport Transfers": "/images/services/airport-transfer.jpg",
  "Temple Tours": "/images/services/temple-tours.jpg",
  "Premium Fleet Rental": "/images/services/corporate.jpg"
};

const heroImage = categoryImages[category] || '/images/logo.png';

const schema = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": `${title} - Kalidass Travels`,
  "description": description,
  "url": Astro.url.href,
  "image": `https://kalidasstravels.in${heroImage}`
};
---

<Layout 
  title={`${title} - Kalidass Travels`}
  description={description}
  image={heroImage}
  schema={schema}
>
  <main class="bg-gray-50 min-h-screen py-20">
    <!-- Hero Header -->
    <div class="bg-black text-white pt-32 pb-16 px-6 relative overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-red-900/40 to-black z-0"></div>
      <div class="max-w-7xl mx-auto relative z-10 text-center">
        <span class="inline-block py-1 px-3 rounded-full bg-red-600/20 border border-red-500/30 text-red-400 text-xs font-semibold tracking-wider mb-4 uppercase">
          Service Category
        </span>
        <h1 class="text-3xl md:text-5xl font-bold mb-4 leading-tight">{title}</h1>
        <p class="text-gray-300 text-lg max-w-2xl mx-auto">{description}</p>
      </div>
    </div>

    <!-- Dedicated Corporate Section (only for corporate category) -->
    {category === 'corporate' && (
      <section class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8 mb-12 mt-[-4rem] relative z-30 border border-gray-100">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center gap-2">
          <i class="fa-solid fa-building text-red-600"></i> Corporate Services
        </h2>
        <ul class="list-disc pl-6 text-gray-800 space-y-2 mb-6">
          <li><b>Employee Transportation:</b> Monthly Cab Services, Shift Pickups, Safe Staff Movement</li>
          <li><b>Event Support:</b> Shuttle services for corporate events, conferences, and offsites</li>
          <li><b>Billing:</b> <span class="font-semibold text-green-700">GST Invoicing Available</span> for all corporate clients</li>
        </ul>
        <div class="flex flex-col md:flex-row gap-4 items-center">
          <a href="#corporate-quote" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow transition text-lg">Get a Corporate Quote</a>
          <span class="text-gray-500 text-sm">Quick response guaranteed</span>
        </div>
      </section>
    )}

    <!-- Corporate Quote Form (only for corporate category) -->
    {category === 'corporate' && (
      <section id="corporate-quote" class="max-w-2xl mx-auto bg-gray-50 rounded-xl shadow p-8 mb-12 border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
          <i class="fa-solid fa-envelope text-blue-600"></i> Get a Corporate Quote
        </h3>
        <form name="corporate-quote" method="POST" data-netlify="true" class="space-y-4">
          <input type="hidden" name="form-name" value="corporate-quote" />
          <div>
            <label class="block text-gray-700 font-semibold mb-1">Company Name</label>
            <input type="text" name="company" required class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-400" placeholder="Your Company Name" />
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-1">Number of Employees</label>
            <input type="number" name="employees" min="1" required class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-400" placeholder="e.g. 50" />
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-1">Type of Service Needed</label>
            <select name="service" required class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-400">
              <option value="Employee Transportation">Employee Transportation</option>
              <option value="Event Support">Event Support</option>
              <option value="Monthly Cab">Monthly Cab</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-1">Contact Email / Phone</label>
            <input type="text" name="contact" required class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-400" placeholder="Email or Phone" />
          </div>
          <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow transition">Request Quote</button>
        </form>
      </section>
    )}

    <!-- Existing Service Cards -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-8 relative z-20">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {categoryServices.map((service) => (
          <a 
            href={`/services/${service.slug}`}
            class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 group flex flex-col h-full overflow-hidden"
          >
            <div class="h-48 overflow-hidden relative">
              <img 
                src={serviceImages[service.slug] || serviceCategoryImages[service.category] || '/images/logo.png'} 
                alt={service.title} 
                class="w-full h-full object-cover group-hover:scale-105 transition duration-500" 
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-80"></div>
            </div>
            <div class="p-6 flex-1 flex flex-col">
              <div class="flex items-center justify-between mb-4">
                <span class="text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded uppercase tracking-wide">
                  {service.category}
                </span>
                <i class="fa-solid fa-arrow-right text-gray-300 group-hover:text-red-600 transition-colors"></i>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-red-600 transition-colors">
                {service.title}
              </h3>
              {service.overview && (
                <p class="text-gray-500 text-sm line-clamp-3 mb-4">
                  {service.overview}
                </p>
              )}
              <!-- Mini Tariff Preview -->
              {service.tariff && service.tariff.rows.length > 0 && (
                <div class="bg-gray-50 rounded p-3 text-xs text-gray-600 mb-4">
                  <div class="flex justify-between font-semibold border-b border-gray-200 pb-1 mb-1">
                    <span>{service.tariff.headers[0]}</span>
                    <span>{service.tariff.headers[service.tariff.headers.length - 1]}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>{service.tariff.rows[0][0]}</span>
                    <span class="font-bold text-gray-900">{service.tariff.rows[0][service.tariff.rows[0].length - 1]}</span>
                  </div>
                </div>
              )}
            </div>
            <div class="mt-auto pt-4 px-6 pb-6 border-t border-gray-100 flex items-center justify-between text-sm font-medium">
              <span class="text-gray-600">View Details</span>
              <span class="text-red-600 group-hover:translate-x-1 transition-transform">
                Book Now &rarr;
              </span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </main>
</Layout>
