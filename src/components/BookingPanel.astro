---
import siteContent from '../data/siteContent.json';
const hero = siteContent.hero;
---

<section id="booking-panel" class="relative z-20 -mt-48 px-4 max-w-6xl mx-auto mb-10 md:mb-20">
    <div class="bg-white rounded-2xl shadow-2xl p-1 border-t-4 border-red-600">
      <h2 class="text-xl font-bold text-center text-gray-800 py-3 border-b border-gray-100">
        <span class="lang-en">Book Your Ride</span>
        <span class="lang-ta hidden">роЙроЩрпНроХро│рпН рокропрогродрпНродрпИ роорпБройрпНрокродро┐ро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН</span>
      </h2>
      <div class="flex border-b border-gray-100" role="tablist">
        <button type="button" data-tab="airport" class="flex-1 py-3 text-sm text-center font-bold tracking-wide uppercase text-red-600 border-b-2 border-red-600 bg-red-50 transition" aria-pressed="true">
          <span class="lang-en">Airport Transfer</span>
          <span class="lang-ta hidden">ро╡ро┐рооро╛рой роиро┐ро▓рпИроп роЪро╡ро╛ро░ро┐</span>
        </button>
        <button type="button" data-tab="oneway" class="flex-1 py-3 text-sm text-center font-bold tracking-wide uppercase text-gray-500 hover:text-red-600 transition" aria-pressed="false">
          <span class="lang-en">One Way</span>
          <span class="lang-ta hidden">роТро░рпБ ро╡ро┤ро┐</span>
        </button>
        <button type="button" data-tab="round" class="flex-1 py-3 text-sm text-center font-bold tracking-wide uppercase text-gray-500 hover:text-red-600 transition" aria-pressed="false">
          <span class="lang-en">Round Trip</span>
          <span class="lang-ta hidden">роЗро░рпБ ро╡ро┤ро┐</span>
        </button>
      </div>
    <div class="p-6 md:p-8 space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="relative group">
          <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">
            <span class="lang-en">Pickup</span>
            <span class="lang-ta hidden">рокро┐роХрпНроХрокрпН</span>
          </label>
          <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus-within:ring-2 ring-red-500 transition">
            <i class="fas fa-map-marker-alt text-red-500 mr-3"></i>
            <input type="text" id="pickup" placeholder="Enter City" class="bg-transparent w-full outline-none text-gray-700 font-medium" />
          </div>
        </div>
        <div class="relative group">
          <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">
            <span class="lang-en">Drop</span>
            <span class="lang-ta hidden">роЯро┐ро░ро╛рокрпН</span>
          </label>
          <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus-within:ring-2 ring-red-500 transition">
            <i class="fas fa-location-arrow text-red-500 mr-3"></i>
            <input type="text" id="drop" placeholder="Enter Destination" class="bg-transparent w-full outline-none text-gray-700 font-medium" />
          </div>
        </div>
        <div class="relative group">
          <label id="date-label" class="text-xs font-bold text-gray-500 uppercase mb-1 block">
            <span class="lang-en">Pickup Date &amp; Time</span>
            <span class="lang-ta hidden">рокро┐роХрпНроХрокрпН родрпЗродро┐ & роирпЗро░роорпН</span>
          </label>
          <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus-within:ring-2 ring-red-500 transition cursor-pointer" onclick="document.getElementById('date').focus()">
            <i class="far fa-calendar-alt text-red-500 mr-3"></i>
            <input 
              type="text" 
              id="date" 
              placeholder="Select Date & Time" 
              onfocus="(this.type='datetime-local');try{this.showPicker()}catch(e){}" 
              class="bg-transparent w-full outline-none text-gray-700 font-medium placeholder-gray-400 cursor-pointer" 
            />
          </div>
        </div>
        
        <!-- New Fields Grouped -->
        <div class="grid grid-cols-2 gap-2">
          <div class="relative group">
            <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">
              <span class="lang-en">Passengers</span>
              <span class="lang-ta hidden">рокропрогро┐роХро│рпН</span>
            </label>
            <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-2 py-3 focus-within:ring-2 ring-red-500 transition">
              <select id="passengers" class="bg-transparent w-full outline-none text-gray-700 font-medium appearance-none cursor-pointer text-sm">
                <option value="4">4+ Driver</option>
                <option value="6">6+ Driver</option>
                <option value="7">7+ Driver</option>
                <option value="12">12+ Driver</option>
              </select>
              <i class="fas fa-chevron-down text-gray-400 text-xs ml-1"></i>
            </div>
          </div>

          <div class="relative group">
            <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">
              <span class="lang-en">Vehicle</span>
              <span class="lang-ta hidden">ро╡ро╛роХройроорпН</span>
            </label>
            <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-2 py-3 focus-within:ring-2 ring-red-500 transition">
              <select id="vehicle" class="bg-transparent w-full outline-none text-gray-700 font-medium appearance-none cursor-pointer text-sm">
                <option value="Sedan">Sedan</option>
                <option value="SUV">SUV</option>
                <option value="Crysta">Crysta</option>
                <option value="Tempo">Tempo</option>
              </select>
              <i class="fas fa-chevron-down text-gray-400 text-xs ml-1"></i>
            </div>
          </div>
        </div>

        <div class="relative group hidden" id="return-field">
          <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">
            <span class="lang-en">Return Date &amp; Time</span>
            <span class="lang-ta hidden">родро┐ро░рпБроорпНрокрпБроорпН родрпЗродро┐ & роирпЗро░роорпН</span>
          </label>
          <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus-within:ring-2 ring-red-500 transition cursor-pointer" onclick="document.getElementById('return-date').focus()">
            <i class="far fa-calendar-check text-red-500 mr-3"></i>
            <input 
              type="text" 
              id="return-date" 
              placeholder="Select Return Date"
              onfocus="(this.type='datetime-local');try{this.showPicker()}catch(e){}" 
              class="bg-transparent w-full outline-none text-gray-700 font-medium placeholder-gray-400 cursor-pointer" 
            />
          </div>
        </div>
      </div>
      <button type="button" id="booking-cta" class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white text-lg font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-3 transition transform active:scale-[0.99]">
        <i class="fab fa-whatsapp text-2xl"></i>
        Book on WhatsApp
      </button>
    </div>
  </div>
</section>

<script>
  const panel = document.getElementById('booking-panel');
  const tabs = panel?.querySelectorAll('[data-tab]');
  const bookingButton = document.getElementById('booking-cta');
  const pickupInput = document.getElementById('pickup') as HTMLInputElement | null;
  const dropInput = document.getElementById('drop') as HTMLInputElement | null;
  const dateInput = document.getElementById('date') as HTMLInputElement | null;
  const returnDateInput = document.getElementById('return-date') as HTMLInputElement | null;
  const passengerSelect = document.getElementById('passengers') as HTMLSelectElement | null;
  const vehicleSelect = document.getElementById('vehicle') as HTMLSelectElement | null;
  let currentTripType = 'airport';
  const returnField = document.getElementById('return-field');
  const dateLabel = document.getElementById('date-label');

  // Auto-select vehicle based on passengers
  const updateVehicle = () => {
    if (!passengerSelect || !vehicleSelect) return;
    const pax = passengerSelect.value;
    
    if (pax === '4') vehicleSelect.value = 'Sedan';
    else if (pax === '6') vehicleSelect.value = 'SUV';
    else if (pax === '7') vehicleSelect.value = 'Crysta';
    else if (pax === '12') vehicleSelect.value = 'Tempo';
  };

  if (passengerSelect) {
    passengerSelect.addEventListener('change', updateVehicle);
    // Run once on init to ensure state is synced
    updateVehicle();
  }

  const toggleReturnField = (show: boolean) => {
    if (!returnField) return;
    returnField.classList.toggle('hidden', !show);
    if (!show && returnDateInput) {
      returnDateInput.value = '';
    }
  };

  const setActiveTab = (tabId: string) => {
    currentTripType = tabId;
    tabs?.forEach((tab) => {
      const isActive = tab.getAttribute('data-tab') === tabId;
      tab.setAttribute('aria-pressed', isActive.toString());
      tab.classList.toggle('text-red-600', isActive);
      tab.classList.toggle('border-red-600', isActive);
      tab.classList.toggle('border-b-2', isActive);
      tab.classList.toggle('bg-red-50', isActive);
      tab.classList.toggle('text-gray-500', !isActive);
    });
    toggleReturnField(tabId === 'round');
    if (dateLabel) {
      dateLabel.textContent = 'Pickup Date & Time';
    }
  };

  tabs?.forEach((tab) => {
    tab.addEventListener('click', () => setActiveTab(tab.getAttribute('data-tab') || 'oneway'));
  });
  setActiveTab('airport');

  const bookRide = () => {
    const pickup = pickupInput?.value.trim();
    const drop = dropInput?.value.trim();
    const date = dateInput?.value;
    const returnDate = returnDateInput?.value;
    const vehicle = vehicleSelect?.options[vehicleSelect.selectedIndex].text;
    const passengers = passengerSelect?.options[passengerSelect.selectedIndex].text;

    if (!pickup || !drop) {
      alert('Please enter both Pickup and Drop locations');
      return;
    }

    const message = encodeURIComponent(
      `*New Booking Inquiry*%0A--------------------%0AЁЯЪЧ Type: ${currentTripType === 'airport' ? 'Airport Transfer' : currentTripType === 'round' ? 'Round Trip' : 'One Way'}%0AЁЯУН Pickup: ${pickup}%0AЁЯПБ Drop: ${drop}%0AЁЯУЕ Date: ${date || 'Not specified'}${currentTripType === 'round' ? `%0AЁЯФБ Return: ${returnDate || 'Not specified'}` : ''}%0AЁЯСе Passengers: ${passengers}%0AЁЯЪЩ Vehicle: ${vehicle}`
    );
    window.open(`https://wa.me/919092303060?text=${message}`, '_blank');
  };

  bookingButton?.addEventListener('click', bookRide);

  // Google Maps Autocomplete Integration
  const initAutocomplete = () => {
    const google = (window as any).google;
    if (!google || !google.maps || !google.maps.places) {
        return; // Exit if not ready
    }

    const options = {
      componentRestrictions: { country: 'in' },
      fields: ['address_components', 'geometry', 'icon', 'name'],
      strictBounds: false,
    };

    if (pickupInput) new google.maps.places.Autocomplete(pickupInput, options);
    if (dropInput) new google.maps.places.Autocomplete(dropInput, options);
  };

  // Initialize Google Maps
  window.addEventListener('google-maps-loaded', initAutocomplete);
  
  // Also run on initial load in case the event was missed
  if ((window as any).google && (window as any).google.maps) {
    initAutocomplete();
  }
</script>
